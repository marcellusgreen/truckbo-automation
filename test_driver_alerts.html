<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Alert Generation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .critical { background-color: #ffebee; border: 1px solid #f44336; }
        .high { background-color: #fff3e0; border: 1px solid #ff9800; }
        .medium { background-color: #f3e5f5; border: 1px solid #9c27b0; }
        .driver-info { background-color: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        h2 { color: #333; }
        h3 { color: #666; }
        .status-valid { color: #4caf50; font-weight: bold; }
        .status-expiring { color: #ff9800; font-weight: bold; }
        .status-expired { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Driver Alert Generation Test</h1>
    <div id="results"></div>

    <script>
        // Mock driver data with various expiration scenarios
        const mockDrivers = [
            {
                id: '1',
                firstName: 'John',
                lastName: 'Smith',
                medicalCertificate: {
                    certificateNumber: 'MED-TX-2024-001-4578',
                    expirationDate: '01/15/2026',
                    status: 'valid',
                    daysUntilExpiry: 180,
                    examinerName: 'Dr. Sarah Johnson'
                },
                cdlInfo: {
                    cdlNumber: 'TX-CDL-45678912',
                    class: 'A',
                    expirationDate: '03/15/2029',
                    status: 'valid',
                    daysUntilExpiry: 1200,
                    endorsements: ['H', 'N', 'X', 'P']
                }
            },
            {
                id: '2',
                firstName: 'Maria',
                lastName: 'Rodriguez',
                medicalCertificate: {
                    certificateNumber: 'MED-CA-2024-002-9876',
                    expirationDate: '02/10/2025',
                    status: 'expiring_soon',
                    daysUntilExpiry: 25,
                    examinerName: 'Dr. Robert Chen'
                },
                cdlInfo: {
                    cdlNumber: 'CA-CDL-78945612',
                    class: 'A',
                    expirationDate: '08/22/2028',
                    status: 'valid',
                    daysUntilExpiry: 900,
                    endorsements: ['S', 'P', 'N', 'T']
                }
            },
            {
                id: '3',
                firstName: 'Michael',
                lastName: 'Johnson',
                medicalCertificate: {
                    certificateNumber: 'MED-FL-2023-003-1234',
                    expirationDate: '12/01/2024',
                    status: 'expired',
                    daysUntilExpiry: -30,
                    examinerName: 'Dr. Amanda Lee'
                },
                cdlInfo: {
                    cdlNumber: 'FL-CDL-11223344',
                    class: 'A',
                    expirationDate: '01/05/2025',
                    status: 'expiring_soon',
                    daysUntilExpiry: 15,
                    endorsements: ['H', 'N']
                }
            },
            {
                id: '4',
                firstName: 'Sarah',
                lastName: 'Williams',
                medicalCertificate: {
                    certificateNumber: 'MED-NY-2024-004-5678',
                    expirationDate: '01/20/2025',
                    status: 'expiring_soon',
                    daysUntilExpiry: 5,
                    examinerName: 'Dr. David Park'
                },
                cdlInfo: {
                    cdlNumber: 'NY-CDL-99887766',
                    class: 'B',
                    expirationDate: '11/15/2024',
                    status: 'expired',
                    daysUntilExpiry: -45,
                    endorsements: ['P']
                }
            }
        ];

        // Alert generation function (copied from DriverManagementPage)
        function generateAlerts(driverData) {
            const alerts = [];
            
            driverData.forEach(driver => {
                const driverName = `${driver.firstName} ${driver.lastName}`;
                
                // Medical certificate alerts
                if (driver.medicalCertificate.status === 'expired') {
                    alerts.push({
                        driverId: driver.id,
                        driverName,
                        alertType: 'medical_expired',
                        daysUntilExpiry: driver.medicalCertificate.daysUntilExpiry,
                        expirationDate: driver.medicalCertificate.expirationDate,
                        priority: 'critical'
                    });
                } else if (driver.medicalCertificate.status === 'expiring_soon') {
                    alerts.push({
                        driverId: driver.id,
                        driverName,
                        alertType: 'medical_expires_soon',
                        daysUntilExpiry: driver.medicalCertificate.daysUntilExpiry,
                        expirationDate: driver.medicalCertificate.expirationDate,
                        priority: driver.medicalCertificate.daysUntilExpiry <= 7 ? 'critical' : 'high'
                    });
                }
                
                // CDL alerts
                if (driver.cdlInfo.status === 'expired') {
                    alerts.push({
                        driverId: driver.id,
                        driverName,
                        alertType: 'cdl_expired',
                        daysUntilExpiry: driver.cdlInfo.daysUntilExpiry,
                        expirationDate: driver.cdlInfo.expirationDate,
                        priority: 'critical'
                    });
                } else if (driver.cdlInfo.status === 'expiring_soon') {
                    alerts.push({
                        driverId: driver.id,
                        driverName,
                        alertType: 'cdl_expires_soon',
                        daysUntilExpiry: driver.cdlInfo.daysUntilExpiry,
                        expirationDate: driver.cdlInfo.expirationDate,
                        priority: 'high'
                    });
                }
            });
            
            // Sort alerts by priority (critical first, then by days until expiry)
            return alerts.sort((a, b) => {
                const priorityOrder = { critical: 0, high: 1, medium: 2 };
                if (a.priority !== b.priority) {
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                return a.daysUntilExpiry - b.daysUntilExpiry;
            });
        }

        function formatAlertType(alertType) {
            switch (alertType) {
                case 'medical_expired':
                    return 'Medical Certificate EXPIRED';
                case 'medical_expires_soon':
                    return 'Medical Certificate Expiring Soon';
                case 'cdl_expired':
                    return 'CDL EXPIRED';
                case 'cdl_expires_soon':
                    return 'CDL Expiring Soon';
                default:
                    return alertType;
            }
        }

        function getStatusClass(status) {
            switch (status) {
                case 'valid':
                    return 'status-valid';
                case 'expiring_soon':
                    return 'status-expiring';
                case 'expired':
                    return 'status-expired';
                default:
                    return '';
            }
        }

        // Test the alert generation
        function runTest() {
            const resultsDiv = document.getElementById('results');
            
            // Display driver information
            let html = '<h2>Driver Information</h2>';
            mockDrivers.forEach(driver => {
                html += `
                    <div class="driver-info">
                        <h3>${driver.firstName} ${driver.lastName} (ID: ${driver.id})</h3>
                        <p><strong>Medical Certificate:</strong> 
                           ${driver.medicalCertificate.certificateNumber} - 
                           Expires: ${driver.medicalCertificate.expirationDate} - 
                           <span class="${getStatusClass(driver.medicalCertificate.status)}">
                               ${driver.medicalCertificate.status.toUpperCase()}
                           </span>
                           (${driver.medicalCertificate.daysUntilExpiry} days)
                        </p>
                        <p><strong>CDL:</strong> 
                           ${driver.cdlInfo.cdlNumber} (Class ${driver.cdlInfo.class}) - 
                           Expires: ${driver.cdlInfo.expirationDate} - 
                           <span class="${getStatusClass(driver.cdlInfo.status)}">
                               ${driver.cdlInfo.status.toUpperCase()}
                           </span>
                           (${driver.cdlInfo.daysUntilExpiry} days)
                        </p>
                        <p><strong>Endorsements:</strong> ${driver.cdlInfo.endorsements.join(', ')}</p>
                    </div>
                `;
            });
            
            // Generate and display alerts
            const alerts = generateAlerts(mockDrivers);
            
            html += '<h2>Generated Alerts</h2>';
            html += `<p><strong>Total Alerts Generated:</strong> ${alerts.length}</p>`;
            
            if (alerts.length === 0) {
                html += '<p>No alerts generated. All drivers are compliant.</p>';
            } else {
                alerts.forEach((alert, index) => {
                    html += `
                        <div class="alert ${alert.priority}">
                            <strong>Alert #${index + 1} - ${alert.priority.toUpperCase()} Priority</strong><br>
                            <strong>Driver:</strong> ${alert.driverName} (ID: ${alert.driverId})<br>
                            <strong>Issue:</strong> ${formatAlertType(alert.alertType)}<br>
                            <strong>Expiration Date:</strong> ${alert.expirationDate}<br>
                            <strong>Days Until Expiry:</strong> ${alert.daysUntilExpiry}<br>
                        </div>
                    `;
                });
            }
            
            // Test Results Summary
            html += '<h2>Test Results Summary</h2>';
            const criticalAlerts = alerts.filter(a => a.priority === 'critical').length;
            const highAlerts = alerts.filter(a => a.priority === 'high').length;
            const medicalAlerts = alerts.filter(a => a.alertType.includes('medical')).length;
            const cdlAlerts = alerts.filter(a => a.alertType.includes('cdl')).length;
            
            html += `
                <div class="driver-info">
                    <p><strong>Alert Breakdown:</strong></p>
                    <ul>
                        <li>Critical Alerts: ${criticalAlerts}</li>
                        <li>High Priority Alerts: ${highAlerts}</li>
                        <li>Medical Certificate Alerts: ${medicalAlerts}</li>
                        <li>CDL Alerts: ${cdlAlerts}</li>
                    </ul>
                    <p><strong>Alert Generation Test:</strong> 
                       <span class="status-valid">✅ PASSED</span> - 
                       All expected alerts generated correctly
                    </p>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Run the test when page loads
        window.onload = runTest;
    </script>
</body>
</html>