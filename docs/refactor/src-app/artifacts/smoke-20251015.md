# Smoke Test Checklist (2025-10-15)

> **Note:** These steps require the interactive browser flows and API services running together. They cannot be completed entirely inside the Codex CLI, so use these instructions during a local session and record the outputs listed in the _Artifacts_ section once finished.

## Environment Preparation
- Node: confirm `node -v` matches project baseline (>= v22.17.1).
- NPM: confirm `npm -v` (>= 11.4.2).
- Env: ensure `VITE_REFACTOR_DEBUG=true` and `VITE_USE_FLEET_HOOK=true` (already set in `.env`).
- Start services in two terminals:
  1. `npm run api:dev`
  2. `npm run dev`
- Sign in with the seeded demo account (see `docs/auth/seed-users.md` if you need credentials).

## Checklist

### 1. Fleet Dashboard Load
- [ ] Navigate to **Dashboard** after login.
- Expected: centralized stats render with no console errors or fallback warnings.
- Capture: console screenshot or log snippet showing successful fetch + component render.
- Observed: see `Fleet Dashboard Load Console Output` below; repeated 422/500 responses from `POST /api/v1/vehicles` surfaced while closing the onboarding modal, so follow-up is required before checking this item.

### 2. Manual Add Vehicle
- [ ] Go to **Fleet → + New Vehicle**.
- [ ] Submit a sample vehicle (use fake VIN if needed).
- Expected: success toast; vehicle appears without duplicate rows after refresh.
- Capture: network log showing adapter request + screenshot of new row.
- Observed: Backend updated to send organization context + auto-generate a truck number; ad hoc `npx tsx` script confirmed a manual add succeeds with generated truck number and no 500s. Production endpoint still needs redeploy before the checklist can be marked complete.

### 3. Bulk CSV Upload
- [ ] Open **Bulk Upload** and import the sample CSV (`mock-fleet-documents/sample-fleet-upload.csv`).
- Expected: success toast; new records persist after a manual refresh (`refresh fleet` control).
- Capture: network log + hook debug line indicating centralized refresh.

### 4. Document Ingestion Pipeline
- [ ] Use **Document Upload** or **Multi-Batch Upload** to submit `mock-fleet-documents/sample-registration.pdf`.
- [ ] Watch `/api/v1/documents/process-status/:jobId` polling until status is `succeeded`.
- Expected: job metadata populated, Neon payload saved (check devtools > Network).
- Capture: status response JSON + refactor debug log snippet.

### 5. Compliance Dashboard Refresh
- [ ] Navigate to **Comprehensive Compliance** view.
- Expected: cards and charts reflect the updated fleet counts; no reliance on `fleetDataManager` fallback.
- Capture: console screenshot or exported JSON of compliance stats.

## Artifacts to Update
- `docs/refactor/src-app/artifacts/logs-20251007.md` → append 2025-10-15 run with timestamped notes.
- `docs/refactor/src-app/artifacts/data-shapes/` → store updated JSON snapshots (`centralized-fleet-20251015.json`, etc.).
- `docs/refactor/src-app/artifacts/smoke-20251015.md` (this file) → mark checkboxes and append observations/screenshots references.

## Captured Logs

### Fleet Dashboard Load Console Output

```text
logger.ts:199 [INFO] APP/Unknown Starting polling for 1 async jobs {message: 'Starting polling for 1 async jobs', context: {…}}
logger.ts:199 [INFO] APP/Unknown Starting status polling for job: projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 {message: 'Starting status polling for job: projects/wired-armor-471701-i1/operations/24fefaebf6e42d05', context: {…}}
logger.ts:199 [INFO] APP/Unknown Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: processing (attempt 1) {message: 'Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: processing (attempt 1)', context: {…}}
logger.ts:199 [INFO] APP/Unknown Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: processing (attempt 2) {message: 'Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: processing (attempt 2)', context: {…}}
logger.ts:199 [INFO] APP/Unknown Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: succeeded (attempt 3) {message: 'Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 status: succeeded (attempt 3)', context: {…}}
logger.ts:199 [INFO] APP/Unknown Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 completed successfully {message: 'Job projects/wired-armor-471701-i1/operations/24fefaebf6e42d05 completed successfully', context: {…}}
App.tsx:71 📄 OnboardingPage: Document processing complete [{…}]
App.tsx:103 📄 OnboardingPage: Using centralized service to add vehicles
centralizedFleetDataService.ts:116 [FleetData] Starting atomic add vehicles operation
persistentFleetStorage.ts:145  POST https://truckbovercelneon.vercel.app/api/v1/vehicles 422 (Unprocessable Content)
(anonymous) @ persistentFleetStorage.ts:145
await in (anonymous)
wrapOperation @ errorHandlingService.ts:324
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ centralizedFleetDataService.ts:139
de @ App.tsx:107
ve @ DocumentUploadModal.tsx:111
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
Vg @ DocumentUploadModal.tsx:459
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
_0 @ react-dom-client.development.js:16216
l @ scheduler.development.js:45
<Vg>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:1007
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
<ZE>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
eV @ App.tsx:2645
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
logger.ts:206 [ERROR] storage/PersistentFleetStorage Operation 'async-operation' failed: Failed to add vehicle {message: "Operation 'async-operation' failed: Failed to add vehicle", context: {…}, data: {…}, error: "Operation 'async-operation' failed: Failed to add vehicle", stack: "Error: Operation 'async-operation' failed: Failed …on.vercel.app/assets/index-DSUCv8in.js:604:43382)"}
outputToConsole @ logger.ts:206
addLogEntry @ logger.ts:171
error @ logger.ts:274
handleError @ errorHandlingService.ts:202
wrapOperation @ errorHandlingService.ts:335
await in wrapOperation
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ centralizedFleetDataService.ts:139
de @ App.tsx:107
ve @ DocumentUploadModal.tsx:111
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
Vg @ DocumentUploadModal.tsx:459
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
_0 @ react-dom-client.development.js:16216
l @ scheduler.development.js:45
<Vg>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:1007
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
<ZE>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
eV @ App.tsx:2645
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
logger.ts:199 [INFO] api/ReconcilerAPI Starting operation: Adding document to reconciliation system {message: 'Starting operation: Adding document to reconciliation system', context: {…}, data: {…}}
vehicleReconciler.ts:243 📄 Adding document: centralized_service_1PTYR15E19PA31569_1760374454370
vehicleReconciler.ts:261 🆕 Created new vehicle record for VIN: 1PTYR15E19PA31569
vehicleReconciler.ts:707 🔍 Document type inference debug: {documentType: 'registration', document_type: undefined, flexibleValidation: undefined, extractedFields: undefined, fileName: 'unknown', …}
vehicleReconciler.ts:721 🎯 Extracted document type: registration
vehicleReconciler.ts:759 🎯 Final document type determination: {originalType: 'registration', inferredFromFileName: null, finalType: 'registration', fileName: ''}
vehicleReconciler.ts:783 🗓️ Extracting effective date from document: {datePaths: Array(5), extractedData: undefined, documentData: {…}, hasFlexibleValidation: false}
vehicleReconciler.ts:801 🔍 Checking path "effectiveDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "effective_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "startDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "issue_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "issueDate": undefined
vehicleReconciler.ts:783 🗓️ Extracting expiration date from document: {datePaths: Array(14), extractedData: undefined, documentData: {…}, hasFlexibleValidation: false}
vehicleReconciler.ts:801 🔍 Checking path "expirationDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "expiry": undefined
vehicleReconciler.ts:801 🔍 Checking path "expiration_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "due_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "dueDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "expires": undefined
vehicleReconciler.ts:801 🔍 Checking path "expiresOn": undefined
vehicleReconciler.ts:801 🔍 Checking path "expires_on": undefined
vehicleReconciler.ts:801 🔍 Checking path "validUntil": undefined
vehicleReconciler.ts:801 🔍 Checking path "valid_until": undefined
vehicleReconciler.ts:801 🔍 Checking path "endDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "end_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "renewalDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "renewal_date": undefined
vehicleReconciler.ts:783 🗓️ Extracting issue date from document: {datePaths: Array(6), extractedData: undefined, documentData: {…}, hasFlexibleValidation: false}
vehicleReconciler.ts:801 🔍 Checking path "issueDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "issue_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "issuedDate": undefined
vehicleReconciler.ts:801 🔍 Checking path "issued_date": undefined
vehicleReconciler.ts:801 🔍 Checking path "dateIssued": undefined
vehicleReconciler.ts:801 🔍 Checking path "date_issued": undefined
vehicleReconciler.ts:181 💾 VehicleReconciler data saved to storage
vehicleReconciler.ts:287 ✅ Document added to VIN 1PTYR15E19PA31569. Total documents: 1
logger.ts:199 [INFO] api/ReconcilerAPI Document successfully added to reconciler {message: 'Document successfully added to reconciler', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Starting operation: Getting vehicle summary view {message: 'Starting operation: Getting vehicle summary view', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Completed operation: Getting vehicle summary view {message: 'Completed operation: Getting vehicle summary view', context: {…}, data: {…}}
centralizedFleetDataService.ts:69 [FleetData] Event bus triggered, refreshing data
centralizedFleetDataService.ts:341 [FleetData] Refreshing data from all sources
logger.ts:199 [INFO] api/ReconcilerAPI Starting operation: Getting all vehicle summaries {message: 'Starting operation: Getting all vehicle summaries', context: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Processing 1 vehicles for summary views {message: 'Processing 1 vehicles for summary views', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Starting operation: Getting vehicle summary view {message: 'Starting operation: Getting vehicle summary view', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Completed operation: Getting vehicle summary view {message: 'Completed operation: Getting vehicle summary view', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Completed operation: Getting all vehicle summaries {message: 'Completed operation: Getting all vehicle summaries', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Starting operation: Getting fleet dashboard {message: 'Starting operation: Getting fleet dashboard', context: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Generated fresh dashboard data {message: 'Generated fresh dashboard data', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Completed operation: Getting fleet dashboard {message: 'Completed operation: Getting fleet dashboard', context: {…}, data: {…}}
logger.ts:199 [INFO] api/ReconcilerAPI Completed operation: Adding document to reconciliation system {message: 'Completed operation: Adding document to reconciliation system', context: {…}, data: {…}}
centralizedFleetDataService.ts:324 [FleetData] Already loading data, skipping refresh
centralizedFleetDataService.ts:69 [FleetData] Event bus triggered, refreshing data
centralizedFleetDataService.ts:324 [FleetData] Already loading data, skipping refresh
centralizedFleetDataService.ts:200 [FleetData] Atomic add vehicles completed successfully
App.tsx:110 ✅ OnboardingPage: Successfully processed 0 vehicles via centralized service
centralizedFleetDataService.ts:419 [FleetData] Data refresh complete. 6 vehicles loaded
App.tsx:1011 🔄 Modal closed, refreshing vehicles...
persistentFleetStorage.ts:145  POST https://truckbovercelneon.vercel.app/api/v1/vehicles 500 (Internal Server Error)
(anonymous) @ persistentFleetStorage.ts:145
await in (anonymous)
wrapOperation @ errorHandlingService.ts:324
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ fleetStorageAdapter.ts:165
ae @ App.tsx:275
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:933
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
_0 @ react-dom-client.development.js:16216
l @ scheduler.development.js:45
<ZE>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
eV @ App.tsx:2645
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
logger.ts:206 [ERROR] storage/PersistentFleetStorage Operation 'async-operation' failed: Failed to add vehicle {message: "Operation 'async-operation' failed: Failed to add vehicle", context: {…}, data: {…}, error: "Operation 'async-operation' failed: Failed to add vehicle", stack: "Error: Operation 'async-operation' failed: Failed …on.vercel.app/assets/index-DSUCv8in.js:604:45597)"}
outputToConsole @ logger.ts:206
addLogEntry @ logger.ts:171
error @ logger.ts:274
handleError @ errorHandlingService.ts:202
wrapOperation @ errorHandlingService.ts:335
await in wrapOperation
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ fleetStorageAdapter.ts:165
ae @ App.tsx:275
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:933
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
_0 @ react-dom-client.development.js:16216
l @ scheduler.development.js:45
<ZE>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
eV @ App.tsx:2645
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
persistentFleetStorage.ts:145  POST https://truckbovercelneon.vercel.app/api/v1/vehicles 500 (Internal Server Error)
(anonymous) @ persistentFleetStorage.ts:145
await in (anonymous)
wrapOperation @ errorHandlingService.ts:324
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ fleetStorageAdapter.ts:165
ae @ App.tsx:275
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:933
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
_0 @ react-dom-client.development.js:16216
l @ scheduler.development.js:45
<ZE>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
eV @ App.tsx:2645
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
logger.ts:206 [ERROR] storage/PersistentFleetStorage Operation 'async-operation' failed: Failed to add vehicle {message: "Operation 'async-operation' failed: Failed to add vehicle", context: {…}, data: {…}, error: "Operation 'async-operation' failed: Failed to add vehicle", stack: "Error: Operation 'async-operation' failed: Failed …on.vercel.app/assets/index-DSUCv8in.js:604:45597)"}
outputToConsole @ logger.ts:206
addLogEntry @ logger.ts:171
error @ logger.ts:274
handleError @ errorHandlingService.ts:202
wrapOperation @ errorHandlingService.ts:335
await in wrapOperation
async @ errorHandlingService.ts:681
addVehicle @ persistentFleetStorage.ts:142
addVehicles @ fleetStorageAdapter.ts:165
ae @ App.tsx:275
Xo @ react-dom-client.development.js:16368
Ne @ react-dom-client.development.js:1519
z0 @ react-dom-client.development.js:16418
(anonymous) @ react-dom-client.development.js:17016
pp @ react-dom-client.development.js:3262
Yd @ react-dom-client.development.js:16572
lm @ react-dom-client.development.js:20658
ny @ react-dom-client.development.js:20626
<button>
Wc.jsxDEV @ react-jsx-dev-runtime.development.js:346
ZE @ App.tsx:933
react_stack_bottom_frame @ react-dom-client.development.js:23863
Pu @ react-dom-client.development.js:5629
zu @ react-dom-client.development.js:5541
Nd @ react-dom-client.development.js:8897
Sd @ react-dom-client.development.js:10522
Ne @ react-dom-client.development.js:1519
D0 @ react-dom-client.development.js:15140
y0 @ react-dom-client.development.js:14956
_d @ react-dom-client.development.js:14936
b0 @ react-dom-client.development.js:14419
I0 @ react-dom-client.development.js:16231
ti @ react-dom-client.development.js:16079
$d @ react-dom-client.development.js:16116
(anonymous) @ react-dom-client.development.js:16250
```

### Manual Add Vehicle API Logs

```text
2025-10-13T17:15:26.404Z [info] [INFO] api/RequestLogger API Request: POST /api/v1/vehicles {
  message: 'API Request: POST /api/v1/vehicles',
  context: {
    layer: 'api',
    component: 'RequestLogger',
    operation: 'POST /api/v1/vehicles',
    requestId: 'req_1760375726399_824k1whc9',
    userId: undefined,
    sessionId: 'session_1760374370240_h8e15gl5e',
    timestamp: '2025-10-13T17:15:26.400Z'
  },
  data: {
    method: 'POST',
    url: '/api/v1/vehicles',
    query: {},
    params: {},
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36',
    ipAddress: '127.0.0.1',
    contentType: 'application/json'
  }
}
2025-10-13T17:15:26.404Z [info] [INFO] api/VehiclesController Creating/updating vehicle {
  message: 'Creating/updating vehicle',
  context: {
    layer: 'api',
    component: 'VehiclesController',
    operation: 'POST /vehicles',
    requestId: 'req_1760375726400_aqxo53det',
    userId: undefined,
    sessionId: 'session_1760374370240_h8e15gl5e',
    timestamp: '2025-10-13T17:15:26.400Z'
  },
  data: { vin: '1PTYR15E19PA31569', truckNumber: 'Vehicle 1569' }
}
2025-10-13T17:15:26.978Z [error] [ERROR] api/VehiclesController Failed to create/update vehicle {
  message: 'Failed to create/update vehicle',
  context: {
    layer: 'api',
    component: 'VehiclesController',
    operation: 'POST /vehicles',
    requestId: 'req_1760375726400_aqxo53det',
    userId: undefined,
    sessionId: 'session_1760374370240_h8e15gl5e',
    timestamp: '2025-10-13T17:15:26.977Z'
  },
  data: {
    requestBody: {
      vin: '1PTYR15E19PA31569',
      make: 'CLASS',
      model: 'CLASS',
      year: 2024,
      licensePlate: 'CLA657',
      truckNumber: 'Vehicle 1569',
      status: 'active'
    }
  },
  error: 'column \"last_updated\" of relation \"vehicles\" does not exist',
  stack: 'error: column \"last_updated\" of relation \"vehicles\" does not exist\n' +
    '    at /var/task/node_modules/pg-pool/index.js:45:11\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async NeonFleetStorage.updateVehicle (/var/task/api/dist/shared/services/neonFleetStorage.js:34:21)\n' +
    '    at async /var/task/api/dist/server/api/routes/vehicles.js:174:36'
}
2025-10-13T17:15:26.978Z [error] [ERROR] api/ErrorHandlingMiddleware API Error {
  message: 'API Error',
  context: {
    layer: 'api',
    component: 'ErrorHandlingMiddleware',
    operation: 'POST /api/v1/vehicles',
    requestId: 'req_1760375726400_aqxo53det',
    userId: undefined,
    sessionId: 'session_1760374370240_h8e15gl5e',
    timestamp: '2025-10-13T17:15:26.978Z'
  },
  data: {
    url: '/api/v1/vehicles',
    method: 'POST',
    body: {
      vin: '1PTYR15E19PA31569',
      make: 'CLASS',
      model: 'CLASS',
      year: 2024,
      licensePlate: 'CLA657',
      truckNumber: 'Vehicle 1569',
      status: 'active'
    },
    query: {},
    params: {},
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36',
    ipAddress: '127.0.0.1'
  },
  error: 'column \"last_updated\" of relation \"vehicles\" does not exist',
  stack: 'error: column \"last_updated\" of relation \"vehicles\" does not exist\n' +
    '    at /var/task/node_modules/pg-pool/index.js:45:11\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async NeonFleetStorage.updateVehicle (/var/task/api/dist/shared/services/neonFleetStorage.js:34:21)\n' +
    '    at async /var/task/api/dist/server/api/routes/vehicles.js:174:36'
}
2025-10-13T17:15:26.979Z [info] [INFO] api/ResponseLogger API Response: POST /api/v1/vehicles - 500 {
  message: 'API Response: POST /api/v1/vehicles - 500',
  context: {
    layer: 'api',
    component: 'ResponseLogger',
    operation: 'POST /api/v1/vehicles',
    requestId: 'req_1760375726399_824k1whc9',
    userId: undefined,
    sessionId: 'session_1760374370240_h8e15gl5e',
    timestamp: '2025-10-13T17:15:26.978Z'
  },
  data: { statusCode: 500, processingTime: 579, responseSize: 505 }
}
```

### AI Document Add Console (2025-10-14)

Context: automated document ingestion path; included here to explain the 422 surfaced during checklist step 2 attempts.

```text
App.tsx:2463 ? Storage system initialized successfully
react-dom-client.development.js:3867 Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.
centralizedFleetDataService.ts:116 [FleetData] Starting atomic add vehicles operation
/api/v1/vehicles:1  Failed to load resource: the server responded with a status of 422 ()
logger.ts:206 [ERROR] storage/PersistentFleetStorage Operation 'async-operation' failed: Failed to add vehicle {message: "Operation 'async-operation' failed: Failed to add vehicle", ...}
VehicleReconciler.ts:261 ?? Created new vehicle record for VIN: 1GCRCPE07C2298420
centralizedFleetDataService.ts:200 [FleetData] Atomic add vehicles completed successfully
App.tsx:110 ? OnboardingPage: Successfully processed 0 vehicles via centralized service
```

### Manual Add Vehicle Console (2025-10-14)

Context: manual `+ New Vehicle` modal submission; payload hit `/api/v1/vehicles` and the API returned 500, so the record was not created.

```text
persistentFleetStorage.ts:145  POST https://truckbovercelneon.vercel.app/api/v1/vehicles 500 (Internal Server Error)
logger.ts:206 [ERROR] storage/PersistentFleetStorage Operation 'async-operation' failed: Failed to add vehicle {message: "Operation 'async-operation' failed: Failed to add vehicle", context: {...}, data: {...}, error: "Operation 'async-operation' failed: Failed to add vehicle", stack: "..."}
AddVehicleModal.tsx:146 Submission failed - dismissing modal with error state
```

### Manual Add Vehicle Script (2025-10-14)

Context: executed an ad hoc `npx tsx` script against the updated API code. The script auto-generated a truck number (`Unit 995`) and inserted the record without error; the cleanup script removed the test record afterwards.

```text
savedVehicle {
  id: 'fa8e4e10-d08c-467f-b33d-47f2285b9cf5',
  organization_id: '550e8400-e29b-41d4-a716-446655440000',
  vin: '1HGCM82633A999995',
  make: 'ManualTest',
  model: 'API',
  year: 2024,
  license_plate: 'MANUAL99',
  truck_number: 'Unit 995',
  status: 'active',
  date_added: 2025-10-14T14:41:32.449Z,
  last_updated: 2025-10-14T14:41:32.449Z
}
Removed test vehicle fa8e4e10-d08c-467f-b33d-47f2285b9cf5
```
## Follow-Up
- Once all steps are green, remove the event-bus refresh fallback noted in `docs/refactor/src-app/dependency-map.md`.
- Notify the team in the progress log entry (`progress-20250926.md`) that Phase 0 smoke validation is complete with artifact locations.




